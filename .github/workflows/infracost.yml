on:
  pull_request:
    paths:
      - "**.tf"
      - "**.tfvars"
      - "**.tfvars.json"

jobs:
  infracost:
    runs-on: ubuntu-latest
    name: Show infracost diff
    steps:
      - uses: actions/checkout@v2
      - uses: infracost/infracost-gh-action@master
        env:
          INFRACOST_API_KEY: ${{ secrets.INFRACOST_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          TF_VAR_aws_access_key: ${{ secrets.TF_AWS_ACCESS_KEY }}
          TF_VAR_aws_secret_key: ${{ secrets.TF_AWS_SECRET_KEY }}
          TF_VAR_cloudflare_token: ${{ secrets.TF_CLOUDFLARE_TOKEN }}
          TF_VAR_digitalocean_token: ${{ secrets.TF_DIGITALOCEAN_TOKEN }}
        with:
          entrypoint: /scripts/ci/diff.sh
          path: ./infrastructure
